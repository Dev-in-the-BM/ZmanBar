this time i got: [11/9/2025 11:47:57 PM] KosherZmanim object loaded successfully. [11/9/2025 11:47:57 PM] JDate extension: Initializing location service... [11/9/2025 11:47:57 PM] JDate extension: Geoclue.Simple object created. [11/9/2025 11:47:57 PM] JDate extension: Connected to notify::location signal.

but it still doesnt tell me WHICH location, what time it has shkiah, etc


Gemini
Thinking
Of course. It's good that we're getting more logs; it helps us pinpoint exactly where things are getting stuck.

The logs show that the Geoclue.Simple object is created and the notify::location signal is connected, but the callback for get_client_async is never being executed. This is a classic sign of a permissions issue. GNOME Shell is very strict about which applications can access your location, and your extension needs to be explicitly allowed.

The desktop_id you're providing (ZmanBar@dev-in-the-bm.github.io) is used by Geoclue to check which application is making the request. For it to be recognized, you need to create a corresponding .desktop file. This file acts as an application manifest that the system can use for permissions.

Here's what we need to do:

1. Create a .desktop file
You need to create a file that tells the system about your extension. This file should be placed in /usr/share/applications/ for system-wide access or ~/.local/share/applications/ for user-specific access. Since this is for an extension, the user-specific directory is appropriate.

Create the following file:

File: ~/.local/share/applications/org.gnome.shell.extensions.ZmanBar.desktop

ini
 Show full code block 
[Desktop Entry]
Name=ZmanBar GNOME Shell Extension
Comment=Access location for zmanim calculations
Exec=/usr/bin/gnome-shell
Icon=org.gnome.shell.extensions.ZmanBar
Type=Application
Categories=Utility;
The Icon entry is optional but good practice. The critical part is that this file exists and is named correctly.

2. Grant Location Permissions
After creating the .desktop file, you need to grant it permission to access location services. You can do this through Settings -> Privacy -> Location Services.

Open Settings.
Go to Privacy & Security -> Location Services.
Make sure Location Services is turned ON.
You should see "ZmanBar GNOME Shell Extension" in the list of applications. Turn the switch next to it ON.
If you don't see it in the list immediately, a restart of GNOME Shell or a logout/login might be required for the system to pick up the new .desktop file.

3. Refine the extension.js Code
With the permissions handled, let's make a small but important change to the extension.js code. The notify::location signal only fires when the location changes. If Geoclue already has a cached location, it might not fire on startup. We need to manually check for a location right after the service starts.

I'll re-introduce the manual check inside the get_client_async callback. This ensures we get a location update immediately if one is available.

extension.js
-3
+7
 Show full code block 
                this._clueSimple.set_property('time-threshold', 600);
                this._clueSimple.start();
                log('JDate extension: Geoclue.Simple service started.');

                // The 'notify::location' signal should fire shortly after start()
                // if a location is available, so a manual call is often not needed.
                
                // Manually trigger an update if a location is already available,
                // as the 'notify::location' signal only fires on change.
                if (this._clueSimple.get_location()) {
                    log('JDate extension: Initial location found, triggering update.');
                    this._onLocationUpdate();
                }
            } catch (e) {
                log(`JDate extension: Geoclue service not available. Falling back to midnight updates. Error: ${e}`);
                this._scheduleMidnightUpdate();

Summary and Next Steps
Create the .desktop file as described above.
Enable Location Services for the extension in your system settings.
Apply the code change to extension.js.
Restart GNOME Shell (Alt+F2, then r, then Enter).
After these steps, check your ~/.ZmanBar.log file again. You should now see the full sequence of logs, including the location being found and the first shkiah update being scheduled.

